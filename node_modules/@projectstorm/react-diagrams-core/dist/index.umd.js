/*! For license information please see index.umd.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["projectstorm/react-canvas-core"]=t():e["projectstorm/react-canvas-core"]=t()}(self,(()=>(()=>{"use strict";var e={634:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagramEngine=void 0;const o=i(80),s=i(270),r=i(702);class n extends r.CanvasEngine{constructor(e={}){super(e),this.maxNumberPointsPerLink=1e3,this.nodeFactories=new r.FactoryBank,this.linkFactories=new r.FactoryBank,this.portFactories=new r.FactoryBank,this.labelFactories=new r.FactoryBank;const t=e=>{e.registerListener({factoryAdded:e=>{e.factory.setDiagramEngine(this)},factoryRemoved:e=>{e.factory.setDiagramEngine(null)}})};t(this.nodeFactories),t(this.linkFactories),t(this.portFactories),t(this.labelFactories)}getMouseElement(e){var t=e.target,i=this.model,o=r.Toolkit.closest(t,".port[data-name]");if(o){var s=r.Toolkit.closest(t,".node[data-nodeid]");return i.getNode(s.getAttribute("data-nodeid")).getPort(o.getAttribute("data-name"))}return(o=r.Toolkit.closest(t,".point[data-id]"))?i.getLink(o.getAttribute("data-linkid")).getPointModel(o.getAttribute("data-id")):(o=r.Toolkit.closest(t,"[data-linkid]"))?i.getLink(o.getAttribute("data-linkid")):(o=r.Toolkit.closest(t,".node[data-nodeid]"))?i.getNode(o.getAttribute("data-nodeid")):null}getNodeFactories(){return this.nodeFactories}getLinkFactories(){return this.linkFactories}getLabelFactories(){return this.labelFactories}getPortFactories(){return this.portFactories}getFactoryForNode(e){return"string"==typeof e?this.nodeFactories.getFactory(e):this.nodeFactories.getFactory(e.getType())}getFactoryForLink(e){return"string"==typeof e?this.linkFactories.getFactory(e):this.linkFactories.getFactory(e.getType())}getFactoryForLabel(e){return"string"==typeof e?this.labelFactories.getFactory(e):this.labelFactories.getFactory(e.getType())}getFactoryForPort(e){return"string"==typeof e?this.portFactories.getFactory(e):this.portFactories.getFactory(e.getType())}generateWidgetForLink(e){return this.getFactoryForLink(e).generateReactWidget({model:e})}generateWidgetForNode(e){return this.getFactoryForNode(e).generateReactWidget({model:e})}getNodeElement(e){const t=this.canvas.querySelector(`.node[data-nodeid="${e.getID()}"]`);if(null===t)throw new Error("Cannot find Node element with nodeID: ["+e.getID()+"]");return t}getNodePortElement(e){var t=this.canvas.querySelector(`.port[data-name="${e.getName()}"][data-nodeid="${e.getParent().getID()}"]`);if(null===t)throw new Error("Cannot find Node Port element with nodeID: ["+e.getParent().getID()+"] and name: ["+e.getName()+"]");return t}getPortCenter(e){return this.getPortCoords(e).getOrigin()}getPortCoords(e,t){if(!this.canvas)throw new Error("Canvas needs to be set first");t||(t=this.getNodePortElement(e));const i=t.getBoundingClientRect(),o=this.getRelativeMousePoint({clientX:i.left,clientY:i.top}),r=this.model.getZoomLevel()/100;return new s.Rectangle(o.x,o.y,i.width/r,i.height/r)}getNodeDimensions(e){if(!this.canvas)return{width:0,height:0};const t=this.getNodeElement(e).getBoundingClientRect();return{width:t.width,height:t.height}}getBoundingNodesRect(e){if(e)return 0===e.length?new s.Rectangle(0,0,0,0):s.Polygon.boundingBoxFromPolygons(e.map((e=>e.getBoundingBox())))}zoomToFitSelectedNodes(e){const t=this.model.getSelectedEntities().filter((e=>e instanceof o.NodeModel));this.zoomToFitNodes({margin:e.margin,maxZoom:e.maxZoom,nodes:t.length>0?t:null})}zoomToFitNodes(e){let t=e||0,i=[],o=null;e&&"object"==typeof e&&(t=e.margin||0,i=e.nodes||[],o=e.maxZoom||null),0===i.length&&(i=this.model.getNodes());const s=this.getBoundingNodesRect(i);if(s){let e=this.canvas.getBoundingClientRect();const i=(t=0)=>{const i=this.canvas.clientWidth/(s.getWidth()+2*t),r=this.canvas.clientHeight/(s.getHeight()+2*t);let n=i<r?i:r;return o&&n>o&&(n=o),{zoom:n,x:e.width/2-((s.getWidth()+2*t)/2+s.getTopLeft().x)*n+t,y:e.height/2-((s.getHeight()+2*t)/2+s.getTopLeft().y)*n+t}};let r=i(0);t&&(r.x<t||r.y<t)&&(r=i(t)),this.model.setZoomLevel(100*r.zoom),this.model.setOffset(r.x,r.y),this.repaintCanvas()}}getMaxNumberPointsPerLink(){return this.maxNumberPointsPerLink}setMaxNumberPointsPerLink(e){this.maxNumberPointsPerLink=e}}t.DiagramEngine=n},848:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelModel=void 0;const o=i(702);class s extends o.BaseModel{constructor(e){super(Object.assign(Object.assign({},e),{offsetX:e.offsetX||0,offsetY:e.offsetY||0}))}deserialize(e){super.deserialize(e),this.options.offsetX=e.data.offsetX,this.options.offsetY=e.data.offsetY}serialize(){return Object.assign(Object.assign({},super.serialize()),{offsetX:this.options.offsetX,offsetY:this.options.offsetY})}}t.LabelModel=s},868:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelWidget=void 0;const o=i(689),s=i(480);var r;!function(e){e.Label=s.default.div`
		display: inline-block;
		position: absolute;
	`,e.Foreign=s.default.foreignObject`
		pointer-events: none;
		overflow: visible;
	`}(r||(r={}));class n extends o.Component{constructor(e){super(e),this.findPathAndRelativePositionToRenderLabel=e=>{const t=this.props.label.getParent(),i=t.getRenderedPath().map((e=>e.getTotalLength()));let o=i.reduce(((e,t)=>e+t),0)*(e/(t.getLabels().length+1)),s=0;for(;s<t.getRenderedPath().length;){if(o-i[s]<0)return{path:t.getRenderedPath()[s],position:o};o-=i[s],s++}},this.calculateLabelPosition=()=>{const e=this.findPathAndRelativePositionToRenderLabel(this.props.index+1);if(!e)return;const{path:t,position:i}=e,o=this.ref.current.offsetWidth,s=this.ref.current.offsetHeight,r=t.getPointAtLength(i),n=r.x-o/2+this.props.label.getOptions().offsetX,a=r.y-s/2+this.props.label.getOptions().offsetY;this.ref.current.style.transform=`translate(${n}px, ${a}px)`},this.ref=o.createRef()}componentDidUpdate(){window.requestAnimationFrame(this.calculateLabelPosition)}componentDidMount(){window.requestAnimationFrame(this.calculateLabelPosition)}render(){const e=this.props.engine.getCanvas();return o.createElement(r.Foreign,{key:this.props.label.getID(),width:null==e?void 0:e.offsetWidth,height:null==e?void 0:e.offsetHeight},o.createElement(r.Label,{ref:this.ref},this.props.engine.getFactoryForLabel(this.props.label).generateReactWidget({model:this.props.label})))}}t.LabelWidget=n},597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkLayerFactory=void 0;const o=i(689),s=i(702),r=i(513),n=i(949);class a extends s.AbstractReactFactory{constructor(){super("diagram-links")}generateModel(e){return new r.LinkLayerModel}generateReactWidget(e){return o.createElement(n.LinkLayerWidget,{layer:e.model,engine:this.engine})}}t.LinkLayerFactory=a},513:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkLayerModel=void 0;const o=i(702),s=i(126);class r extends o.LayerModel{constructor(){super({type:"diagram-links",isSvg:!0,transformed:!0})}addModel(e){if(!(e instanceof s.LinkModel))throw new Error("Can only add links to this layer");e.registerListener({entityRemoved:()=>{this.getParent().removeLink(e)}}),super.addModel(e)}getLinks(){return this.getModels()}getChildModelFactoryBank(e){return e.getLinkFactories()}}t.LinkLayerModel=r},949:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkLayerWidget=void 0;const o=i(689),s=i(480),r=i(517),n=i(370);var a;!function(e){e.Container=s.default.div``}(a||(a={}));class d extends o.Component{render(){return o.createElement(o.Fragment,null,r.map(this.props.layer.getLinks(),(e=>o.createElement(n.LinkWidget,{key:e.getID(),link:e,diagramEngine:this.props.engine}))))}}t.LinkLayerWidget=d},126:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkModel=void 0;const o=i(19),s=i(517),r=i(270),n=i(702);class a extends n.BaseModel{constructor(e){super(e),this.points=[new o.PointModel({link:this}),new o.PointModel({link:this})],this.sourcePort=null,this.targetPort=null,this.renderedPaths=[],this.labels=[]}getBoundingBox(){return r.Polygon.boundingBoxFromPoints(s.map(this.points,(e=>e.getPosition())))}getSelectionEntities(){return this.getTargetPort()&&this.getSourcePort()?super.getSelectionEntities().concat(s.slice(this.points,1,this.points.length-1)):this.getSourcePort()?this.getTargetPort()?super.getSelectionEntities().concat(this.points):super.getSelectionEntities().concat(s.slice(this.points,1,this.points.length)):super.getSelectionEntities().concat(s.slice(this.points,0,this.points.length-1))}deserialize(e){super.deserialize(e),this.points=s.map(e.data.points||[],(t=>{var i=new o.PointModel({link:this,position:new r.Point(t.x,t.y)});return i.deserialize(Object.assign(Object.assign({},e),{data:t})),i})),s.forEach(e.data.labels||[],(t=>{let i=e.engine.getFactoryForLabel(t.type).generateModel({});i.deserialize(Object.assign(Object.assign({},e),{data:t})),this.addLabel(i)})),e.data.target&&e.getModel(e.data.targetPort).then((e=>{this.setTargetPort(e)})),e.data.source&&e.getModel(e.data.sourcePort).then((e=>{this.setSourcePort(e)}))}getRenderedPath(){return this.renderedPaths}setRenderedPaths(e){this.renderedPaths=e}serialize(){return Object.assign(Object.assign({},super.serialize()),{source:this.sourcePort?this.sourcePort.getParent().getID():null,sourcePort:this.sourcePort?this.sourcePort.getID():null,target:this.targetPort?this.targetPort.getParent().getID():null,targetPort:this.targetPort?this.targetPort.getID():null,points:s.map(this.points,(e=>e.serialize())),labels:s.map(this.labels,(e=>e.serialize()))})}doClone(e={},t){t.setPoints(s.map(this.getPoints(),(t=>t.clone(e)))),this.sourcePort&&t.setSourcePort(this.sourcePort.clone(e)),this.targetPort&&t.setTargetPort(this.targetPort.clone(e))}clearPort(e){this.sourcePort===e?this.setSourcePort(null):this.targetPort===e&&this.setTargetPort(null)}remove(){this.sourcePort&&(this.sourcePort.removeLink(this),delete this.sourcePort),this.targetPort&&(this.targetPort.removeLink(this),delete this.targetPort),super.remove()}isLastPoint(e){return this.getPointIndex(e)===this.points.length-1}getPointIndex(e){return this.points.indexOf(e)}getPointModel(e){for(var t=0;t<this.points.length;t++)if(this.points[t].getID()===e)return this.points[t];return null}getPortForPoint(e){return null!==this.sourcePort&&this.getFirstPoint().getID()===e.getID()?this.sourcePort:null!==this.targetPort&&this.getLastPoint().getID()===e.getID()?this.targetPort:null}getPointForPort(e){return null!==this.sourcePort&&this.sourcePort.getID()===e.getID()?this.getFirstPoint():null!==this.targetPort&&this.targetPort.getID()===e.getID()?this.getLastPoint():null}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}setSourcePort(e){null!==e&&e.addLink(this),null!==this.sourcePort&&this.sourcePort.removeLink(this),this.sourcePort=e,this.fireEvent({port:e},"sourcePortChanged"),(null==e?void 0:e.reportedPosition)&&this.getPointForPort(e).setPosition(e.getCenter())}getSourcePort(){return this.sourcePort}getTargetPort(){return this.targetPort}setTargetPort(e){null!==e&&e.addLink(this),null!==this.targetPort&&this.targetPort.removeLink(this),this.targetPort=e,this.fireEvent({port:e},"targetPortChanged"),(null==e?void 0:e.reportedPosition)&&this.getPointForPort(e).setPosition(e.getCenter())}point(e,t,i=1){return this.addPoint(this.generatePoint(e,t),i)}addLabel(e){e.setParent(this),this.labels.push(e)}getPoints(){return this.points}getLabels(){return this.labels}setPoints(e){s.forEach(e,(e=>{e.setParent(this)})),this.points=e}removePoint(e){this.isLastPoint(e)&&this.remove(),this.points.splice(this.getPointIndex(e),1)}removePointsBefore(e){this.points.splice(0,this.getPointIndex(e))}removePointsAfter(e){this.points.splice(this.getPointIndex(e)+1)}removeMiddlePoints(){this.points.length>2&&this.points.splice(1,this.points.length-2)}addPoint(e,t=1){return e.setParent(this),this.points.splice(t,0,e),e}generatePoint(e=0,t=0){return new o.PointModel({link:this,position:new r.Point(e,t)})}}t.LinkModel=a},370:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkWidget=void 0;const o=i(689),s=i(517),r=i(868),n=i(702);class a extends o.Component{constructor(e){super(e),this.state={sourcePort:null,targetPort:null}}componentWillUnmount(){this.sourceListener&&this.sourceListener.deregister(),this.targetListener&&this.targetListener.deregister()}static getDerivedStateFromProps(e,t){return{sourcePort:e.link.getSourcePort(),targetPort:e.link.getTargetPort()}}installTarget(){this.targetListener&&this.targetListener.deregister(),this.props.link.getTargetPort()&&(this.targetListener=this.props.link.getTargetPort().registerListener({reportInitialPosition:e=>{this.forceUpdate()}}))}installSource(){this.sourceListener&&this.sourceListener.deregister(),this.props.link.getSourcePort()&&(this.sourceListener=this.props.link.getSourcePort().registerListener({reportInitialPosition:e=>{this.forceUpdate()}}))}componentDidUpdate(e,t,i){t.sourcePort!==this.state.sourcePort&&this.installSource(),t.targetPort!==this.state.targetPort&&this.installTarget()}static generateLinePath(e,t){return`M${e.getX()},${e.getY()} L ${t.getX()},${t.getY()}`}componentDidMount(){this.props.link.getSourcePort()&&this.installSource(),this.props.link.getTargetPort()&&this.installTarget()}render(){const{link:e}=this.props;return e.getSourcePort()&&!e.getSourcePort().reportedPosition||e.getTargetPort()&&!e.getTargetPort().reportedPosition?null:o.createElement(n.PeformanceWidget,{model:this.props.link,serialized:this.props.link.serialize()},(()=>o.createElement("g",{"data-linkid":this.props.link.getID()},this.props.diagramEngine.generateWidgetForLink(e),s.map(this.props.link.getLabels(),((e,t)=>o.createElement(r.LabelWidget,{key:e.getID(),engine:this.props.diagramEngine,label:e,index:t}))))))}}t.LinkWidget=a},19:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PointModel=void 0;const o=i(702);class s extends o.BasePositionModel{constructor(e){super(Object.assign(Object.assign({},e),{type:"point"})),this.parent=e.link}isConnectedToPort(){return null!==this.parent.getPortForPoint(this)}getLink(){return this.getParent()}remove(){this.parent&&this.parent.removePoint(this),super.remove()}isLocked(){return super.isLocked()||this.getParent().isLocked()}}t.PointModel=s},167:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeLayerFactory=void 0;const o=i(689),s=i(702),r=i(210),n=i(518);class a extends s.AbstractReactFactory{constructor(){super("diagram-nodes")}generateModel(e){return new r.NodeLayerModel}generateReactWidget(e){return o.createElement(n.NodeLayerWidget,{layer:e.model,engine:this.engine})}}t.NodeLayerFactory=a},210:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeLayerModel=void 0;const o=i(702),s=i(80);class r extends o.LayerModel{constructor(){super({type:"diagram-nodes",isSvg:!1,transformed:!0})}addModel(e){if(!(e instanceof s.NodeModel))throw new Error("Can only add nodes to this layer");e.registerListener({entityRemoved:()=>{this.getParent().removeNode(e)}}),super.addModel(e)}getChildModelFactoryBank(e){return e.getNodeFactories()}getNodes(){return this.getModels()}}t.NodeLayerModel=r},518:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeLayerWidget=void 0;const o=i(689),s=i(480),r=i(517),n=i(556);var a;!function(e){e.Container=s.default.div``}(a||(a={}));class d extends o.Component{render(){return o.createElement(o.Fragment,null,r.map(this.props.layer.getNodes(),(e=>o.createElement(n.NodeWidget,{key:e.getID(),diagramEngine:this.props.engine,node:e}))))}}t.NodeLayerWidget=d},80:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeModel=void 0;const o=i(517),s=i(270),r=i(702);class n extends r.BasePositionModel{constructor(e){super(e),this.ports={},this.width=0,this.height=0}getBoundingBox(){return new s.Rectangle(this.getPosition(),this.width,this.height)}setPosition(e,t){const i=this.position;e instanceof s.Point?super.setPosition(e):super.setPosition(e,t),o.forEach(this.ports,(e=>{e.setPosition(e.getX()+this.position.x-i.x,e.getY()+this.position.y-i.y)}))}deserialize(e){super.deserialize(e),o.forEach(e.data.ports,(t=>{let i=e.engine.getFactoryForPort(t.type).generateModel({});i.deserialize(Object.assign(Object.assign({},e),{data:t})),e.registerModel(i),this.addPort(i)}))}serialize(){return Object.assign(Object.assign({},super.serialize()),{ports:o.map(this.ports,(e=>e.serialize()))})}doClone(e={},t){t.ports={},o.forEach(this.ports,(i=>{t.addPort(i.clone(e))}))}remove(){super.remove(),o.forEach(this.ports,(e=>{o.forEach(e.getLinks(),(e=>{e.remove()}))}))}getPortFromID(e){for(var t in this.ports)if(this.ports[t].getID()===e)return this.ports[t];return null}getLink(e){for(let t in this.ports){const i=this.ports[t].getLinks();if(i[e])return i[e]}}getPort(e){return this.ports[e]}getPorts(){return this.ports}removePort(e){for(let t of o.values(e.getLinks()))t.clearPort(e);this.ports[e.getName()]&&(this.ports[e.getName()].setParent(null),delete this.ports[e.getName()])}addPort(e){return e.setParent(this),this.ports[e.getName()]=e,e}updateDimensions({width:e,height:t}){this.width=e,this.height=t}}t.NodeModel=n},556:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeWidget=void 0;const o=i(689),s=i(517),r=i(702),n=i(480),a=i(827);var d;!function(e){e.Node=n.default.div`
		position: absolute;
		-webkit-touch-callout: none; /* iOS Safari */
		-webkit-user-select: none; /* Chrome/Safari/Opera */
		user-select: none;
		cursor: move;
		pointer-events: all;
	`}(d||(d={}));class l extends o.Component{constructor(e){super(e),this.ref=o.createRef()}componentWillUnmount(){var e;this.ob.disconnect(),this.ob=null,null===(e=this.listener)||void 0===e||e.deregister(),this.listener=null}componentDidUpdate(e,t,i){this.listener&&this.props.node!==e.node&&(this.listener.deregister(),this.installSelectionListener())}installSelectionListener(){this.listener=this.props.node.registerListener({selectionChanged:e=>{this.forceUpdate()}})}updateSize(e,t){this.props.node.updateDimensions({width:e,height:t});try{s.forEach(this.props.node.getPorts(),(e=>{e.updateCoords(this.props.diagramEngine.getPortCoords(e))}))}catch(e){}}componentDidMount(){this.ob=new a.default((e=>{const t=e[0].contentRect;this.updateSize(t.width,t.height)}));const e=this.ref.current.getBoundingClientRect();this.updateSize(e.width,e.height),this.ob.observe(this.ref.current),this.installSelectionListener()}render(){return o.createElement(r.PeformanceWidget,{model:this.props.node,serialized:this.props.node.serialize()},(()=>o.createElement(d.Node,{className:"node",ref:this.ref,"data-nodeid":this.props.node.getID(),style:{top:this.props.node.getY(),left:this.props.node.getX()}},this.props.diagramEngine.generateWidgetForNode(this.props.node))))}}t.NodeWidget=l},531:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PortModel=t.PortModelAlignment=void 0;const o=i(517),s=i(270),r=i(702);!function(e){e.TOP="top",e.LEFT="left",e.BOTTOM="bottom",e.RIGHT="right"}(t.PortModelAlignment||(t.PortModelAlignment={}));class n extends r.BasePositionModel{constructor(e){super(e),this.links={},this.reportedPosition=!1}deserialize(e){super.deserialize(e),this.reportedPosition=!1,this.options.name=e.data.name,this.options.alignment=e.data.alignment}serialize(){return Object.assign(Object.assign({},super.serialize()),{name:this.options.name,alignment:this.options.alignment,parentNode:this.parent.getID(),links:o.map(this.links,(e=>e.getID()))})}setPosition(e,t){let i=this.position;super.setPosition(e,t),o.forEach(this.getLinks(),(o=>{let s=o.getPointForPort(this);s.setPosition(s.getX()+e-i.x,s.getY()+t-i.y)}))}doClone(e={},t){t.links={},t.parent=this.getParent().clone(e)}getNode(){return this.getParent()}getName(){return this.options.name}getMaximumLinks(){return this.options.maximumLinks}setMaximumLinks(e){this.options.maximumLinks=e}removeLink(e){delete this.links[e.getID()]}addLink(e){this.links[e.getID()]=e}getLinks(){return this.links}createLinkModel(){if(o.isFinite(this.options.maximumLinks)){var e=o.size(this.links);if(1===this.options.maximumLinks&&e>=1)return o.values(this.links)[0];if(e>=this.options.maximumLinks)return null}return null}reportPosition(){o.forEach(this.getLinks(),(e=>{e.getPointForPort(this).setPosition(this.getCenter())})),this.fireEvent({entity:this},"reportInitialPosition")}getCenter(){return new s.Point(this.getX()+this.width/2,this.getY()+this.height/2)}getBoundingBox(){return new s.Rectangle(this.position,this.width,this.height)}updateCoords(e){this.width=e.getWidth(),this.height=e.getHeight(),this.setPosition(e.getTopLeft()),this.reportedPosition=!0,this.reportPosition()}canLinkToPort(e){return!0}isLocked(){return super.isLocked()||this.getParent().isLocked()}}t.PortModel=n},302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PortWidget=void 0;const o=i(689),s=i(517),r=i(702);class n extends o.Component{constructor(e){super(e),this.ref=o.createRef()}report(){this.props.port.updateCoords(this.props.engine.getPortCoords(this.props.port,this.ref.current))}componentWillUnmount(){this.engineListenerHandle&&this.engineListenerHandle.deregister()}componentDidUpdate(e,t,i){this.props.port.reportedPosition||this.report()}componentDidMount(){this.engineListenerHandle=this.props.engine.registerListener({canvasReady:()=>{this.report()}}),this.props.engine.getCanvas()&&this.report()}getExtraProps(){if(r.Toolkit.TESTING){return{"data-links":s.keys(this.props.port.getNode().getPort(this.props.port.getName()).links).join(",")}}return{}}render(){return o.createElement("div",Object.assign({style:this.props.style,ref:this.ref,className:`port ${this.props.className||""}`,"data-name":this.props.port.getName(),"data-nodeid":this.props.port.getNode().getID()},this.getExtraProps()),this.props.children)}}t.PortWidget=n},418:function(e,t,i){var o=this&&this.__createBinding||(Object.create?function(e,t,i,o){void 0===o&&(o=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,o,s)}:function(e,t,i,o){void 0===o&&(o=i),e[o]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||o(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),s(i(389),t),s(i(848),t),s(i(126),t),s(i(19),t),s(i(370),t),s(i(513),t),s(i(949),t),s(i(597),t),s(i(210),t),s(i(518),t),s(i(167),t),s(i(80),t),s(i(556),t),s(i(531),t),s(i(302),t),s(i(876),t),s(i(930),t),s(i(132),t),s(i(634),t)},389:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagramModel=void 0;const o=i(517),s=i(126),r=i(80),n=i(702),a=i(210),d=i(513);class l extends n.CanvasModel{constructor(e={}){super(e),this.addLayer(new d.LinkLayerModel),this.addLayer(new a.NodeLayerModel)}deserialize(e){this.layers=[],super.deserialize(e)}addLayer(e){super.addLayer(e),e instanceof a.NodeLayerModel&&(this.activeNodeLayer=e),e instanceof d.LinkLayerModel&&(this.activeLinkLayer=e)}getLinkLayers(){return o.filter(this.layers,(e=>e instanceof d.LinkLayerModel))}getNodeLayers(){return o.filter(this.layers,(e=>e instanceof a.NodeLayerModel))}getActiveNodeLayer(){if(!this.activeNodeLayer){const e=this.getNodeLayers();0===e.length?this.addLayer(new a.NodeLayerModel):this.activeNodeLayer=e[0]}return this.activeNodeLayer}getActiveLinkLayer(){if(!this.activeLinkLayer){const e=this.getLinkLayers();0===e.length?this.addLayer(new d.LinkLayerModel):this.activeLinkLayer=e[0]}return this.activeLinkLayer}getNode(e){for(const t of this.getNodeLayers()){const i=t.getModel(e);if(i)return i}}getLink(e){for(const t of this.getLinkLayers()){const i=t.getModel(e);if(i)return i}}addAll(...e){return o.forEach(e,(e=>{e instanceof s.LinkModel?this.addLink(e):e instanceof r.NodeModel&&this.addNode(e)})),e}addLink(e){return this.getActiveLinkLayer().addModel(e),this.fireEvent({link:e,isCreated:!0},"linksUpdated"),e}addNode(e){return this.getActiveNodeLayer().addModel(e),this.fireEvent({node:e,isCreated:!0},"nodesUpdated"),e}removeLink(e){o.some(this.getLinkLayers(),(t=>t.removeModel(e)))&&this.fireEvent({link:e,isCreated:!1},"linksUpdated")}removeNode(e){o.some(this.getNodeLayers(),(t=>t.removeModel(e)))&&this.fireEvent({node:e,isCreated:!1},"nodesUpdated")}getLinks(){return o.flatMap(this.getLinkLayers(),(e=>o.values(e.getModels())))}getNodes(){return o.flatMap(this.getNodeLayers(),(e=>o.values(e.getModels())))}}t.DiagramModel=l},876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultDiagramState=void 0;const o=i(702),s=i(531),r=i(132),n=i(930);class a extends o.State{constructor(){super({name:"default-diagrams"}),this.childStates=[new o.SelectingState],this.dragCanvas=new o.DragCanvasState,this.dragNewLink=new r.DragNewLinkState,this.dragItems=new n.DragDiagramItemsState,this.registerAction(new o.Action({type:o.InputType.MOUSE_DOWN,fire:e=>{const t=this.engine.getActionEventBus().getModelForEvent(e);t?t instanceof s.PortModel?this.transitionWithEvent(this.dragNewLink,e):this.transitionWithEvent(this.dragItems,e):this.transitionWithEvent(this.dragCanvas,e)}})),this.registerAction(new o.Action({type:o.InputType.TOUCH_START,fire:e=>{this.transitionWithEvent(this.dragCanvas,e)}}))}}t.DefaultDiagramState=a},930:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DragDiagramItemsState=void 0;const o=i(702),s=i(517),r=i(19),n=i(531);class a extends o.MoveItemsState{constructor(){super(),this.registerAction(new o.Action({type:o.InputType.MOUSE_UP,fire:e=>{const t=this.engine.getMouseElement(e.event);t instanceof n.PortModel&&s.forEach(this.initialPositions,(e=>{if(e.item instanceof r.PointModel){const i=e.item.getParent();if(i.getLastPoint()!==e.item)return;i.getSourcePort().canLinkToPort(t)&&(i.setTargetPort(t),t.reportPosition(),this.engine.repaintCanvas())}}))}}))}}t.DragDiagramItemsState=a},132:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DragNewLinkState=void 0;const o=i(702),s=i(531);class r extends o.AbstractDisplacementState{constructor(e={}){super({name:"drag-new-link"}),this.config=Object.assign({allowLooseLinks:!0,allowLinksFromLockedPorts:!1},e),this.registerAction(new o.Action({type:o.InputType.MOUSE_DOWN,fire:e=>{this.port=this.engine.getMouseElement(e.event),this.config.allowLinksFromLockedPorts||!this.port.isLocked()?(this.link=this.port.createLinkModel(),this.link?(this.link.setSelected(!0),this.link.setSourcePort(this.port),this.engine.getModel().addLink(this.link),this.port.reportPosition()):this.eject()):this.eject()}})),this.registerAction(new o.Action({type:o.InputType.MOUSE_UP,fire:e=>{const t=this.engine.getMouseElement(e.event);if(t instanceof s.PortModel)return this.port.canLinkToPort(t)?(this.link.setTargetPort(t),t.reportPosition(),void this.engine.repaintCanvas()):(this.link.remove(),void this.engine.repaintCanvas());this.config.allowLooseLinks||(this.link.remove(),this.engine.repaintCanvas())}}))}fireMouseMoved(e){const t=this.port.getPosition(),i=this.engine.getModel().getZoomLevel()/100,o=this.engine.getModel().getOffsetX()/i,s=this.engine.getModel().getOffsetY()/i,r=this.initialXRelative/i,n=this.initialYRelative/i,a=t.x-o+(r-t.x)+e.virtualDisplacementX,d=t.y-s+(n-t.y)+e.virtualDisplacementY;this.link.getLastPoint().setPosition(a,d),this.engine.repaintCanvas()}}t.DragNewLinkState=r},480:e=>{e.exports=require("@emotion/styled")},270:e=>{e.exports=require("@projectstorm/geometry")},702:e=>{e.exports=require("@projectstorm/react-canvas-core")},517:e=>{e.exports=require("lodash")},689:e=>{e.exports=require("react")},827:e=>{e.exports=require("resize-observer-polyfill")}},t={};var i=function i(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,i),r.exports}(418);return i})()));
//# sourceMappingURL=index.umd.js.map