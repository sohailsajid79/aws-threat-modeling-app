{"version":3,"file":"announcements.js","sourceRoot":"","sources":["../../../../src/board/utils/announcements.ts"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AAGtC,OAAO,EAAE,gBAAgB,EAAE,aAAa,EAAE,MAAM,6BAA6B,CAAC;AAS9E;;GAEG;AACH,MAAM,UAAU,2BAA2B,CACzC,UAAyB,EACzB,SAA2B;;IAE3B,MAAM,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG,UAAU,CAAC;IAC3D,MAAM,UAAU,GAAG,MAAA,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,UAAU,CAAC,aAAa,CAAC,EAAE,CAAC,mCAAI,IAAI,CAAC;IAEjG,IAAI,CAAC,WAAW,EAAE;QAChB,OAAO,IAAI,CAAC;KACb;IAED,MAAM,SAAS,GAAG,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IACvC,MAAM,QAAQ,GAAG,MAAA,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,MAAM,mCAAI,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,EAAE,CAAC;IACrD,IAAI,CAAC,QAAQ,EAAE;QACb,OAAO,IAAI,CAAC;KACb;IAED,MAAM,SAAS,GAAG,WAAW,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,QAAQ,CAAC,CAAC;IACzE,MAAM,YAAY,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IACrD,MAAM,SAAS,GAAG,YAAY,aAAZ,YAAY,cAAZ,YAAY,GAAI,UAAU,CAAC;IAE7C,MAAM,SAAS,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;IAEjD,MAAM,SAAS,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;IACxE,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAE3B,OAAO;QACL,IAAI,EAAE,YAAY;QAClB,IAAI,EAAE,UAAU,CAAC,aAAa;QAC9B,SAAS;QACT,SAAS,EAAE;YACT,CAAC,EAAE,SAAS,CAAC,CAAC;YACd,CAAC,EAAE,SAAS,CAAC,CAAC;YACd,KAAK,EAAE,SAAS,CAAC,KAAK;YACtB,MAAM,EAAE,SAAS,CAAC,MAAM;SACzB;QACD,SAAS;QACT,SAAS;QACT,SAAS;KACV,CAAC;AACJ,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,oBAAoB,CAClC,YAAoC,EACpC,KAAoC,EACpC,WAAsC,EACtC,OAAe;IAEf,IAAI,CAAC,YAAY,EAAE;QACjB,OAAO,EAAE,CAAC;KACX;IACD,MAAM,IAAI,GAAG,YAAY,CAAC,IAA0B,CAAC;IAErD,MAAM,MAAM,GAAG,CAAC,EAAU,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA,EAAE,aAAF,EAAE,uBAAF,EAAE,CAAE,EAAE,MAAK,EAAE,CAAE,CAAC;IAClE,MAAM,eAAe,GAAG,CAAC,SAA2B,EAAE,EAAE;QACtD,IAAI,CAAC,SAAS,EAAE;YACd,OAAO,IAAI,CAAC;SACb;QACD,OAAO,SAAS,KAAK,MAAM,IAAI,SAAS,KAAK,OAAO,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,UAAU,CAAC;IACnF,CAAC,CAAC;IAEF,SAAS,2BAA2B,CAAC,YAAmC;QACtE,MAAM,SAAS,GAAG,YAAY,CAAC,SAAS,CAAC;QACzC,MAAM,SAAS,GAAG,eAAe,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;QAC1D,MAAM,SAAS,GAAG,CAAC,GAAG,YAAY,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC1D,MAAM,SAAS,GAAG,CAAC,GAAG,YAAY,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAE1D,QAAQ,YAAY,CAAC,SAAS,EAAE;YAC9B,KAAK,SAAS;gBACZ,OAAO,WAAW,CAAC,gCAAgC,CAAC;oBAClD,IAAI;oBACJ,SAAS;oBACT,SAAS,EAAE,SAAU;oBACrB,SAAS;oBACT,SAAS;iBACV,CAAC,CAAC;YACL,KAAK,QAAQ;gBACX,OAAO,WAAW,CAAC,8BAA8B,CAAC;oBAChD,IAAI;oBACJ,SAAS;oBACT,SAAS,EAAE,SAAU;oBACrB,uBAAuB,EAAE,SAAS,CAAC,KAAK,KAAK,gBAAgB,CAAC,IAAI,EAAE,OAAO,CAAC;oBAC5E,oBAAoB,EAAE,SAAS,CAAC,MAAM,KAAK,aAAa,CAAC,IAAI,CAAC;oBAC9D,SAAS;oBACT,SAAS;iBACV,CAAC,CAAC;YACL,KAAK,QAAQ;gBACX,OAAO,WAAW,CAAC,+BAA+B,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,CAAC,CAAC;SACjG;IACH,CAAC;IAED,SAAS,6BAA6B,CAAC,YAAqC;QAC1E,OAAO,WAAW,CAAC,2BAA2B,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,GAAG,YAAY,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IAC/G,CAAC;IAED,QAAQ,YAAY,CAAC,IAAI,EAAE;QACzB,KAAK,aAAa;YAChB,OAAO,WAAW,CAAC,0BAA0B,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;QACxE,KAAK,YAAY;YACf,OAAO,2BAA2B,CAAC,YAAY,CAAC,CAAC;QACnD,KAAK,eAAe;YAClB,OAAO,WAAW,CAAC,4BAA4B,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;QAC1E,KAAK,eAAe;YAClB,OAAO,WAAW,CAAC,4BAA4B,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;QAC1E,KAAK,cAAc;YACjB,OAAO,6BAA6B,CAAC,YAAY,CAAC,CAAC;KACtD;AACH,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { Direction, ItemId } from \"../../internal/interfaces\";\nimport { getMinColumnSpan, getMinRowSpan } from \"../../internal/utils/layout\";\nimport {\n  BoardProps,\n  DndActionAnnouncement,\n  ItemRemovedAnnouncement,\n  Transition,\n  TransitionAnnouncement,\n} from \"../interfaces\";\n\n/**\n * Creates an announcement object describing the last user move.\n */\nexport function createOperationAnnouncement<D>(\n  transition: Transition<D>,\n  direction: null | Direction,\n): null | DndActionAnnouncement {\n  const { operation, layoutShift, itemsLayout } = transition;\n  const targetItem = itemsLayout.items.find((it) => it.id === transition.draggableItem.id) ?? null;\n\n  if (!layoutShift) {\n    return null;\n  }\n\n  const firstMove = layoutShift.moves[0];\n  const targetId = firstMove?.itemId ?? targetItem?.id;\n  if (!targetId) {\n    return null;\n  }\n\n  const itemMoves = layoutShift.moves.filter((m) => m.itemId === targetId);\n  const lastItemMove = itemMoves[itemMoves.length - 1];\n  const placement = lastItemMove ?? targetItem;\n\n  const conflicts = new Set(layoutShift.conflicts);\n\n  const disturbed = new Set(layoutShift.moves.map((move) => move.itemId));\n  disturbed.delete(targetId);\n\n  return {\n    type: \"dnd-action\",\n    item: transition.draggableItem,\n    operation,\n    placement: {\n      x: placement.x,\n      y: placement.y,\n      width: placement.width,\n      height: placement.height,\n    },\n    direction,\n    conflicts,\n    disturbed,\n  };\n}\n\n/**\n * Applies i18nStrings to the announcement object to produce a string for the live region.\n */\nexport function announcementToString<D>(\n  announcement: TransitionAnnouncement,\n  items: readonly BoardProps.Item<D>[],\n  i18nStrings: BoardProps.I18nStrings<D>,\n  columns: number,\n): string {\n  if (!announcement) {\n    return \"\";\n  }\n  const item = announcement.item as BoardProps.Item<D>;\n\n  const toItem = (id: ItemId) => items.find((it) => it?.id === id)!;\n  const formatDirection = (direction: null | Direction) => {\n    if (!direction) {\n      return null;\n    }\n    return direction === \"left\" || direction === \"right\" ? \"horizontal\" : \"vertical\";\n  };\n\n  function createDndActionAnnouncement(announcement: DndActionAnnouncement) {\n    const placement = announcement.placement;\n    const direction = formatDirection(announcement.direction);\n    const conflicts = [...announcement.conflicts].map(toItem);\n    const disturbed = [...announcement.disturbed].map(toItem);\n\n    switch (announcement.operation) {\n      case \"reorder\":\n        return i18nStrings.liveAnnouncementDndItemReordered({\n          item,\n          placement,\n          direction: direction!,\n          conflicts,\n          disturbed,\n        });\n      case \"resize\":\n        return i18nStrings.liveAnnouncementDndItemResized({\n          item,\n          placement,\n          direction: direction!,\n          isMinimalColumnsReached: placement.width === getMinColumnSpan(item, columns),\n          isMinimalRowsReached: placement.height === getMinRowSpan(item),\n          conflicts,\n          disturbed,\n        });\n      case \"insert\":\n        return i18nStrings.liveAnnouncementDndItemInserted({ item, placement, conflicts, disturbed });\n    }\n  }\n\n  function createItemRemovedAnnouncement(announcement: ItemRemovedAnnouncement) {\n    return i18nStrings.liveAnnouncementItemRemoved({ item, disturbed: [...announcement.disturbed].map(toItem) });\n  }\n\n  switch (announcement.type) {\n    case \"dnd-started\":\n      return i18nStrings.liveAnnouncementDndStarted(announcement.operation);\n    case \"dnd-action\":\n      return createDndActionAnnouncement(announcement);\n    case \"dnd-committed\":\n      return i18nStrings.liveAnnouncementDndCommitted(announcement.operation);\n    case \"dnd-discarded\":\n      return i18nStrings.liveAnnouncementDndDiscarded(announcement.operation);\n    case \"item-removed\":\n      return createItemRemovedAnnouncement(announcement);\n  }\n}\n"]}